diff -Naurp wireguard-linux-compat-1.0.20220627.orig/src/compat/compat.h wireguard-linux-compat-1.0.20220627/src/compat/compat.h
--- wireguard-linux-compat-1.0.20220627.orig/src/compat/compat.h	2022-06-27 11:54:37.000000000 +0100
+++ wireguard-linux-compat-1.0.20220627/src/compat/compat.h	2023-01-14 22:14:17.000000000 +0000
@@ -16,7 +16,7 @@
 #define ISRHEL7
 #elif RHEL_MAJOR == 8
 #define ISRHEL8
-#if RHEL_MINOR >= 6
+#if RHEL_MINOR >= 7
 #define ISCENTOS8S
 #endif
 #endif
@@ -390,7 +390,7 @@ static inline int get_random_bytes_wait(
 #define system_power_efficient_wq system_unbound_wq
 #endif
 
-#if LINUX_VERSION_CODE < KERNEL_VERSION(5, 3, 0)
+#if LINUX_VERSION_CODE < KERNEL_VERSION(5, 3, 0) && !defined(ISRHEL8)
 #include <linux/ktime.h>
 #if LINUX_VERSION_CODE < KERNEL_VERSION(3, 17, 0)
 #include <linux/hrtimer.h>

--- wireguard-linux-compat-1.0.20220627/src/peer.c	2022-06-27 11:54:37.000000000 +0100
+++ wireguard-linux-compat-1.0.20220627/src/peer.c	2023-05-18 16:20:17.263779220 +0100
@@ -54,7 +54,7 @@
 	skb_queue_head_init(&peer->staged_packet_queue);
 	wg_noise_reset_last_sent_handshake(&peer->last_sent_handshake);
 	set_bit(NAPI_STATE_NO_BUSY_POLL, &peer->napi.state);
-	netif_napi_add(wg->dev, &peer->napi, wg_packet_rx_poll,
+	netif_napi_add_weight(wg->dev, &peer->napi, wg_packet_rx_poll,
 		       NAPI_POLL_WEIGHT);
 	napi_enable(&peer->napi);
 	list_add_tail(&peer->peer_list, &wg->peer_list);

